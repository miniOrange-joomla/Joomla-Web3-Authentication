var TokenABIType1 = [{
    inputs: [{internalType: "address", name: "owner", type: "address"}],
    name: "balanceOf",
    outputs: [{internalType: "uint256", name: "", type: "uint256"}],
    type: "function"
}, {
    inputs: [{internalType: "address", name: "owner", type: "address"}, {
        internalType: "uint256",
        name: "index",
        type: "uint256"
    }],
    name: "tokenOfOwnerByIndex",
    outputs: [{internalType: "uint256", name: "", type: "uint256"}],
    stateMutability: "view",
    type: "function"
}, {
    inputs: [{internalType: "uint256", name: "tokenId", type: "uint256"}],
    name: "tokenURI",
    outputs: [{internalType: "string", name: "", type: "string"}],
    stateMutability: "view",
    type: "function"
}, {
    inputs: [{internalType: "uint256", name: "", type: "uint256"}],
    name: "uri",
    outputs: [{internalType: "string", name: "", type: "string"}],
    stateMutability: "view",
    type: "function"
}], TokenABIType2 = [{
    inputs: [{internalType: "address", name: "_owner", type: "address"}, {
        internalType: "uint256",
        name: "_id",
        type: "uint256"
    }],
    name: "balanceOf",
    outputs: [{internalType: "uint256", name: "", type: "uint256"}],
    stateMutability: "view",
    type: "function"
}, {
    inputs: [{internalType: "address", name: "owner", type: "address"}, {
        internalType: "uint256",
        name: "index",
        type: "uint256"
    }],
    name: "tokenOfOwnerByIndex",
    outputs: [{internalType: "uint256", name: "", type: "uint256"}],
    stateMutability: "view",
    type: "function"
}, {
    inputs: [{internalType: "uint256", name: "tokenId", type: "uint256"}],
    name: "tokenURI",
    outputs: [{internalType: "string", name: "", type: "string"}],
    stateMutability: "view",
    type: "function"
}, {
    inputs: [{internalType: "uint256", name: "", type: "uint256"}],
    name: "uri",
    outputs: [{internalType: "string", name: "", type: "string"}],
    stateMutability: "view",
    type: "function"
}];

async function getSolanaTokenDetails(e, t, n) {
    let mo_nonce = document.getElementById('mo_points').value;
    let a = 0;
    return await jQuery.post(ajaxurl, {
        action: "type_of_request",
        request: "getSolanaTokenDetails",
        fieldValue: t,
        fieldKey: n,
        walletAddress: e,
        mo_web3_verify_nonce: mo_nonce
    }, function (t) {
        let n = null, r = "something went wrong: ";
        if (t) try {
            n = JSON.parse(t)
        } catch (i) {
            return alert(r += i), 0
        }
        try {
            a = analyseSolanaDetails(n, e)
        } catch (o) {
            console.log(o), alert(o.message)
        }
    }), a
}

function analyseSolanaDetails(e, t) {
    let n = 0;
    if (e?.error) throw{
        name: "web3 solana",
        message: "Error Occur!!: Probably your configurations or test wallet address is wrong"
    };
    if (e?.nft?.owner) t == e?.nft?.owner && (n = 1); else {
        let a = e?.nfts?.length;
        a = a || 0;
        for (let r = 0; r < a; r++) t == e?.nfts[r]?.owner && (n += 1)
    }
    return n
}

async function checkAndShowNft(e, t, n, a) {
    let r = 0;
    if (n.length > 6 && "solana" == n.substring(0, 6).toLowerCase()) return await getSolanaTokenDetails(e, t, n);
    console.log(e, t);
    let i = new Web3(window.ethereum), o;
    try {
        o = await i.eth.getAccounts()
    } catch (s) {
        console.error("error ", s.message)
    }
    return (r = await checkBalance(TokenABIType1, e, t, n)) < 0 && (r = await checkBalance(TokenABIType2, e, t, n)), r <= 0 && "PolygonMumbai" == n && (r = await getPolygonMumbaiTestnetBalance(t, e, n)), r < 0 && "Ethereum" == n && (r = await getBalanceThroughAPICall(t, e, n)), r
}

function getWeb3ContractObject(e, t, n) {
    let a = new Web3(window.ethereum), r = new a.eth.Contract(e, t);
    return "Ethereum" == n ? r.setProvider("https://cloudflare-eth.com/") : "PolygonMumbai" == n ? r.setProvider("https://rpc-mumbai.maticvigil.com/ ") : "Goerli" == n ? r.setProvider("https://web3-trial.cloudflare-eth.com/v1/goerli") : r.setProvider("https://polygon-rpc.com/"), r
}

async function checkBalance(e, t, n, a) {
    let r;
    try {
        (r = getWeb3ContractObject(e, n, a)).defaultAccount = t
    } catch (i) {
        return alert("Error Occur!!: Probably your configurations or test wallet address is wrong"), 0
    }
    let o, s;
    try {
        return o = await r.methods.balanceOf(t).call(), o = Number(o)
    } catch (l) {
        console.log(l)
    }
    try {
        s = await r.methods.tokenOfOwnerByIndex(t, 0).call()
    } catch (u) {
        return console.log(u), -1
    }
    try {
        o = await r.methods.balanceOf(t, s).call()
    } catch (c) {
        return console.log(c), -1
    }
    return Number(o)
}

async function getPolygonMumbaiTestnetBalance(e, t, n) {
    let mo_nonce = document.getElementById('mo_points').value;
    let a = 0;
    return await jQuery.post(ajaxurl, {
        action: "type_of_request",
        request: "getPolygonMumbaiTestnetBalance",
        blockchain: n,
        wallet_address: t,
        contractAddresses: e,
        mo_web3_verify_nonce: mo_nonce
    }, function (e) {
        a = e
    }), a
}

async function getBalanceThroughAPICall(e, t, n) {
    let mo_nonce = document.getElementById('mo_points').value;
    let a = 0;
    return await jQuery.post(ajaxurl, {
        action: "type_of_request",
        request: "getUserHoldNFTData",
        blockchain: n,
        walletAddress: t,
        contractAddresses: e,
        mo_web3_verify_nonce: mo_nonce
    }, function (e) {
        let t = null, n = "something went wrong: ";
        if (e) try {
            t = JSON.parse(e)
        } catch (r) {
            return alert(n += r), 0
        }
        t.total ? a = Number(a = t.total) : alert(n += t?.error?.message)
    }), a
}